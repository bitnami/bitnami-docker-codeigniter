machine:
  services:
  - docker
  environment:
    IMAGE_NAME: che-codeigniter
    DOCKERFILE: .codenvy.dockerfile
    DOCKER_PROJECT: bitnami
    GCLOUD_PROJECT: bitnami-containers

dependencies:
  override:
  - docker info
  - gcloud version
  - docker pull $DOCKER_PROJECT/$IMAGE_NAME:_ || true

test:
  override:
  - docker build --rm=false -f $DOCKERFILE -t $DOCKER_PROJECT/$IMAGE_NAME:$CIRCLE_BUILD_NUM .

deployment:
  cache:
    branch: che
    commands:
    - curl -sL https://raw.githubusercontent.com/bitnami/test-infra/master/circle/docker-update-cache.sh | bash -
  release:
    tag: /^che-[0-9].*-r[0-9]+$/
    commands:
    - curl -sL https://raw.githubusercontent.com/bitnami/test-infra/master/circle/docker-release-image.sh | bash -
